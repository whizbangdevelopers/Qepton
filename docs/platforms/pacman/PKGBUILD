# Maintainer: whizBANG Developers <support@whizbangdevelopers.com>
pkgname=qepton
pkgver=1.0.8
pkgrel=1
pkgdesc="Prompt and Code Snippet Manager powered by GitHub Gist"
arch=('x86_64')
url="https://github.com/whizbangdevelopers/Qepton"
license=('MIT')
depends=(
    'electron'
    'gtk3'
    'libnotify'
    'nss'
    'libxss'
    'libxtst'
    'xdg-utils'
    'libsecret'
)
optdepends=(
    'libappindicator-gtk3: for system tray support'
)
options=('!strip' '!emptydirs')
source=(
    "${pkgname}-${pkgver}.tar.gz::https://github.com/whizbangdevelopers/Qepton/releases/download/v${pkgver}/Qepton-${pkgver}-linux-x64.tar.gz"
    "qepton.desktop"
    "qepton.sh"
)
sha256sums=('SKIP' 'SKIP' 'SKIP')

package() {
    # Create directories
    install -dm755 "${pkgdir}/opt/${pkgname}"
    install -dm755 "${pkgdir}/usr/bin"
    install -dm755 "${pkgdir}/usr/share/applications"
    install -dm755 "${pkgdir}/usr/share/icons/hicolor/16x16/apps"
    install -dm755 "${pkgdir}/usr/share/icons/hicolor/32x32/apps"
    install -dm755 "${pkgdir}/usr/share/icons/hicolor/48x48/apps"
    install -dm755 "${pkgdir}/usr/share/icons/hicolor/64x64/apps"
    install -dm755 "${pkgdir}/usr/share/icons/hicolor/128x128/apps"
    install -dm755 "${pkgdir}/usr/share/icons/hicolor/256x256/apps"
    install -dm755 "${pkgdir}/usr/share/icons/hicolor/512x512/apps"

    # Install app files
    cp -r "${srcdir}/"* "${pkgdir}/opt/${pkgname}/" 2>/dev/null || true

    # Remove source files we don't need in /opt
    rm -f "${pkgdir}/opt/${pkgname}/qepton.desktop"
    rm -f "${pkgdir}/opt/${pkgname}/qepton.sh"
    rm -f "${pkgdir}/opt/${pkgname}/${pkgname}-${pkgver}.tar.gz"

    # Install launcher script
    install -Dm755 "${srcdir}/qepton.sh" "${pkgdir}/usr/bin/${pkgname}"

    # Install desktop file
    install -Dm644 "${srcdir}/qepton.desktop" "${pkgdir}/usr/share/applications/${pkgname}.desktop"

    # Install icons (from the app's resources)
    if [ -d "${pkgdir}/opt/${pkgname}/resources/icons" ]; then
        for size in 16 32 48 64 128 256 512; do
            if [ -f "${pkgdir}/opt/${pkgname}/resources/icons/${size}x${size}.png" ]; then
                install -Dm644 "${pkgdir}/opt/${pkgname}/resources/icons/${size}x${size}.png" \
                    "${pkgdir}/usr/share/icons/hicolor/${size}x${size}/apps/${pkgname}.png"
            fi
        done
    fi
}
